<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.hz.fcloud.dao.EquipmentDataMapper">
    <select id="findAll" resultType="cn.hz.fcloud.entity.EquipmentData">
        select * from equipment_data
    </select>
    <select id="findOne" parameterType="string" resultType="cn.hz.fcloud.entity.EquipmentData">
        select * from equipment_data where code=#{imei}
    </select>
    <insert id="addRecord" parameterType="cn.hz.fcloud.entity.EquipmentData">
        insert into equipment_data values(#{id,jdbcType=BIGINT}, #{code}, #{info}, #{type}, #{createTime})
    </insert>
    <select id="findType" parameterType="int" resultType="cn.hz.fcloud.entity.EquipmentData">
        select * from equipment_data where type=#{type}
    </select>
    <select id="alarmCount" resultType="int">
         select count(*) from equipment_data where to_days(create_time)=to_days(now()) and type = 0
    </select>
    <select id="alarmCountByCode" resultType="int">
         select count(*) from equipment_data where to_days(create_time)=to_days(now()) and type = 0 and code =#{value}
    </select>
    <select id="AlarmListByCode" resultType="cn.hz.fcloud.entity.EquipmentDataAndName">
         select d.*,e.name from equipment_data d,equipment e where d.code=e.code and
         to_days(d.create_time)=to_days(now()) and d.type = 0 and
         d.code in
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>
    <select id="AlarmTrend" resultType="java.util.HashMap">
        select DATE_FORMAT(create_time,'%m.%d') days,count(id) count from equipment_data where DATE_SUB(CURDATE(), INTERVAL 7 DAY) &lt;= date(create_time) and type =0 GROUP BY days;
    </select>

    <select id="alarmTable" resultType="java.util.HashMap">
          select d.info,e.name,c.name as company,sc.name as city,d.create_time from equipment_data d,equipment e,company c,sys_china sc where to_days(d.create_time)=to_days(now()) and d.type = 0 and d.`code`= e.`code` and e.company_id = c.id and sc.id=c.city
          <if test="ids!=null">
              and c.id in
              <foreach collection="ids" index="index" item="item" open="(" separator="," close=")">
                  #{item}
              </foreach>
          </if>
    </select>

    <select id="lineChartMap" resultType="java.util.HashMap">
        select DATE_FORMAT(d.create_time,'%m.%d') days,count(d.id) count from equipment_data d,equipment e where DATE_SUB(CURDATE(), INTERVAL 7 DAY) &lt;= date(d.create_time) and d.type =0 and d.`code`=e.`code` and
        e.company_id IN
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
        GROUP BY days;
    </select>
    <select id="findAlermEquipmentAndCount" resultType="map">
        select e.type,count(e.type) ct from equipment e left join equipment_data ed on e.code=ed.code group by e.type
    </select>
</mapper>